{
	"info": {
		"_postman_id": "payment-processing-api-v1",
		"name": "Payment Processing API",
		"description": "Colecci√≥n completa para probar el m√≥dulo de procesamiento de pagos con tarjetas d√©bito/cr√©dito.\n\n## üîê Seguridad\n\nLos datos de la tarjeta deben enviarse encriptados en Base64.\n\n## ‚úÖ Mejora de Seguridad: CartId Autom√°tico\n\nEl cartId ahora es OPCIONAL:\n- **Sin cartId** (RECOMENDADO): El sistema busca autom√°ticamente el carrito del usuario autenticado por su email del JWT\n- **Con cartId**: Solo si es necesario especificar un carrito diferente\n\nEsto previene que usuarios maliciosos manipulen el cartId para pagar el carrito de otra persona.\n\n## üéØ Flujo de Prueba\n\n1. Autenticaci√≥n (obtener token JWT)\n2. Crear carrito y agregar productos\n3. Procesar pago con tarjeta (sin cartId - autom√°tico)\n\n## üìã Variables de Entorno\n\n- `base_url`: URL base del API (ej: http://localhost:8080)\n- `token`: Token JWT de autenticaci√≥n\n- `cartId`: ID del carrito activo (OPCIONAL)\n\n## üì¶ Response\n\nLa respuesta incluye:\n- `paymentId`: ID √∫nico del pago\n- `referenceNumber`: N√∫mero de referencia del pago\n- `status`: Estado del pago (Pendiente, Aprobado, Rechazado)\n- `paymentType`: Tipo de pago (debito o credito)\n\n## üöÄ C√≥digos de Error\n\n- ED-PAY-01: Pago no encontrado\n- ED-PAY-02: Datos encriptados inv√°lidos\n- ED-PAY-03: Formato de datos de tarjeta inv√°lido\n- ED-PAY-04: Tipo de pago inv√°lido\n- ED-PAY-12: N√∫mero de tarjeta inv√°lido",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "payment-api"
	},
	"item": [
		{
			"name": "Payments",
			"item": [
				{
					"name": "Process Payment - Auto Cart (Credit) ‚≠ê RECOMMENDED",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has correct structure\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('failure');",
									"    pm.expect(jsonData).to.have.property('code');",
									"    pm.expect(jsonData).to.have.property('body');",
									"});",
									"",
									"pm.test(\"Payment processed successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.failure).to.be.false;",
									"});",
									"",
				"pm.test(\"Payment type is credito\", function () {",
				"    const jsonData = pm.response.json();",
				"    pm.expect(jsonData.body.paymentType).to.equal('credito');",
				"});",
				"",
				"// Guardar paymentId",
				"if (pm.response.code === 200) {",
				"    const jsonData = pm.response.json();",
				"    pm.environment.set('paymentId', jsonData.body.paymentId);",
				"    pm.environment.set('referenceNumber', jsonData.body.referenceNumber);",
				"    console.log('‚úÖ Payment ID:', jsonData.body.paymentId);",
				"    console.log('‚úÖ Reference:', jsonData.body.referenceNumber);",
				"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"1234567812345678\",",
									"    \"cardHolderName\": \"Juan P√©rez\",",
									"    \"expirationDate\": \"12/25\",",
									"    \"cvv\": \"123\",",
									"    \"installments\": 3,",
									"    \"paymentType\": \"credito\"",
									"};",
									"",
									"const base64Encoded = btoa(JSON.stringify(cardData));",
									"pm.variables.set('encryptedCardData', base64Encoded);",
									"",
									"console.log('üîê Card Data:', JSON.stringify(cardData, null, 2));",
									"console.log('üîê Base64:', base64Encoded);",
									"console.log('‚úÖ NO enviando cartId - Se usar√° el carrito del usuario autenticado');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"description": "Token JWT de autenticaci√≥n"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "‚úÖ **RECOMENDADO**: Procesa un pago SIN especificar cartId.\n\n**Seguridad**: El sistema busca autom√°ticamente el carrito activo del usuario autenticado por su email extra√≠do del token JWT.\n\n**Beneficios**:\n- ‚úÖ No se puede manipular el cartId para pagar el carrito de otra persona\n- ‚úÖ M√°s simple (menos par√°metros)\n- ‚úÖ M√°s seguro\n\n**Datos encriptados**:\n- cardNumber: 1234567812345678\n- cardHolderName: Juan P√©rez\n- expirationDate: 12/25\n- cvv: 123\n- installments: 3\n- paymentType: credito\n\n**Campo obligatorio**:\n- encryptedCardData (Base64)"
					},
					"response": []
				},
				{
					"name": "Process Payment - Auto Cart (Debit) ‚≠ê RECOMMENDED",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
				"pm.test(\"Payment type is debito\", function () {",
				"    const jsonData = pm.response.json();",
				"    pm.expect(jsonData.body.paymentType).to.equal('debito');",
				"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"9876543210123456\",",
									"    \"cardHolderName\": \"Mar√≠a Garc√≠a\",",
									"    \"expirationDate\": \"06/26\",",
									"    \"cvv\": \"456\",",
									"    \"paymentType\": \"debito\"",
									"};",
									"",
									"const base64Encoded = btoa(JSON.stringify(cardData));",
									"pm.variables.set('encryptedCardData', base64Encoded);",
									"",
									"console.log('‚úÖ NO enviando cartId - Carrito autom√°tico del usuario');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "‚úÖ **RECOMENDADO**: Procesa un pago d√©bito SIN especificar cartId.\n\n**Datos encriptados**:\n- cardNumber: 9876543210123456\n- cardHolderName: Mar√≠a Garc√≠a\n- expirationDate: 06/26\n- cvv: 456\n- paymentType: debito\n\n**Nota**: Los pagos d√©bito siempre tienen 1 cuota."
					},
					"response": []
				},
				{
					"name": "Process Payment - Credit Card (With cartId)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test 1: Verificar status code",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test 2: Verificar estructura de respuesta",
									"pm.test(\"Response has correct structure\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('failure');",
									"    pm.expect(jsonData).to.have.property('code');",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData).to.have.property('body');",
									"    pm.expect(jsonData).to.have.property('timestamp');",
									"});",
									"",
									"// Test 3: Verificar que no fall√≥",
									"pm.test(\"Payment processed successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.failure).to.be.false;",
									"});",
									"",
									"// Test 4: Verificar body del pago",
									"pm.test(\"Payment body has required fields\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.body).to.have.property('paymentId');",
									"    pm.expect(jsonData.body).to.have.property('referenceNumber');",
									"    pm.expect(jsonData.body).to.have.property('status');",
									"    pm.expect(jsonData.body).to.have.property('paymentType');",
									"    pm.expect(jsonData.body).to.have.property('cardLast4Digits');",
									"});",
									"",
									"// Test 5: Verificar estado inicial",
									"pm.test(\"Payment status is Pendiente\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.body.status).to.equal('Pendiente');",
									"});",
									"",
									"// Test 6: Verificar tipo de pago",
									"pm.test(\"Payment type is credito\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.body.paymentType).to.equal('credito');",
									"});",
									"",
									"// Test 7: Guardar paymentId para futuras requests",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set('paymentId', jsonData.body.paymentId);",
									"    pm.environment.set('referenceNumber', jsonData.body.referenceNumber);",
									"    console.log('‚úÖ Payment ID saved:', jsonData.body.paymentId);",
									"    console.log('‚úÖ Reference Number:', jsonData.body.referenceNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Pre-request: Generar datos encriptados",
									"const cardData = {",
									"    \"cardNumber\": \"1234567812345678\",",
									"    \"cardHolderName\": \"Juan P√©rez\",",
									"    \"expirationDate\": \"12/25\",",
									"    \"cvv\": \"123\",",
									"    \"installments\": 3,",
									"    \"paymentType\": \"credito\"",
									"};",
									"",
									"// Convertir a JSON",
									"const jsonString = JSON.stringify(cardData);",
									"",
									"// Codificar en Base64",
									"const base64Encoded = btoa(jsonString);",
									"",
									"// Guardar en variable temporal",
									"pm.variables.set('encryptedCardData', base64Encoded);",
									"",
									"console.log('üîê Card Data JSON:', jsonString);",
									"console.log('üîê Base64 Encoded:', base64Encoded);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"description": "Token JWT de autenticaci√≥n"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Procesa un pago con tarjeta de cr√©dito especificando un cartId.\n\n‚ö†Ô∏è **NOTA**: Esta forma permite especificar un cartId manualmente. Para mayor seguridad, usa los requests marcados con ‚≠ê RECOMMENDED que buscan el carrito autom√°ticamente.\n\n**Datos encriptados**:\n- cardNumber: 1234567812345678\n- cardHolderName: Juan P√©rez\n- expirationDate: 12/25\n- cvv: 123\n- installments: 3\n- paymentType: credito\n\n**Campos**:\n- cartId: Opcional (si se omite, se busca autom√°ticamente)\n- encryptedCardData (Base64): Obligatorio\n\n**Validaciones**:\n- N√∫mero de tarjeta: 16 d√≠gitos\n- Fecha de vencimiento: formato MM/YY\n- Tipo de pago: \"debito\" o \"credito\""
					},
					"response": [
						{
							"name": "Success - Credit Payment",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"cartId\": 1,\n  \"encryptedCardData\": \"eyJjYXJkTnVtYmVyIjoiMTIzNDU2NzgxMjM0NTY3OCIsImNhcmRIb2xkZXJOYW1lIjoiSnVhbiBQw6lyZXoiLCJleHBpcmF0aW9uRGF0ZSI6IjEyLzI1IiwiY3Z2IjoiMTIzIiwiaW5zdGFsbG1lbnRzIjozLCJwYXltZW50VHlwZSI6ImNyZWRpdG8ifQ==\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/payments/process",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"payments",
										"process"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"failure\": false,\n  \"code\": 200,\n  \"message\": \"Pago procesado exitosamente\",\n  \"body\": {\n    \"paymentId\": 15,\n    \"referenceNumber\": \"F47AC10B-58CC-4372-A567-0E02B2C3D479\",\n    \"status\": \"Pendiente\",\n    \"paymentType\": \"credito\"\n  },\n  \"timestamp\": \"1731506400000\"\n}"
						}
					]
				},
				{
					"name": "Process Payment - Debit Card (With cartId)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment type is debito\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.body.paymentType).to.equal('debito');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"9876543210123456\",",
									"    \"cardHolderName\": \"Mar√≠a Garc√≠a\",",
									"    \"expirationDate\": \"06/26\",",
									"    \"cvv\": \"456\",",
									"    \"paymentType\": \"debito\"",
									"};",
									"",
									"const base64Encoded = btoa(JSON.stringify(cardData));",
									"pm.variables.set('encryptedCardData', base64Encoded);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Procesa un pago con tarjeta de d√©bito especificando un cartId.\n\n‚ö†Ô∏è **NOTA**: Para mayor seguridad, usa los requests ‚≠ê RECOMMENDED.\n\n**Datos encriptados**:\n- cardNumber: 9876543210123456\n- cardHolderName: Mar√≠a Garc√≠a\n- expirationDate: 06/26\n- cvv: 456\n- paymentType: debito\n\n**Nota**: Los pagos d√©bito siempre tienen 1 cuota (ignorando campo installments)."
					},
					"response": [
						{
							"name": "Success - Debit Payment",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"cartId\": 1,\n  \"encryptedCardData\": \"eyJjYXJkTnVtYmVyIjoiOTg3NjU0MzIxMDEyMzQ1NiIsImNhcmRIb2xkZXJOYW1lIjoiTWFyw61hIEdhcmPDrWEiLCJleHBpcmF0aW9uRGF0ZSI6IjA2LzI2IiwiY3Z2IjoiNDU2IiwicGF5bWVudFR5cGUiOiJkZWJpdG8ifQ==\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/payments/process",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"payments",
										"process"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"failure\": false,\n  \"code\": 200,\n  \"message\": \"Pago procesado exitosamente\",\n  \"body\": {\n    \"paymentId\": 16,\n    \"referenceNumber\": \"A8B3D12E-91FF-4C82-B456-1A03C4D5E689\",\n    \"status\": \"Pendiente\",\n    \"paymentType\": \"debito\",\n    \"cardLast4Digits\": \"3456\"\n  },\n  \"timestamp\": \"1731506500000\"\n}"
						}
					]
				},
				{
					"name": "Process Payment - Minimal Data",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Solo campos obligatorios",
									"const cardData = {",
									"    \"cardNumber\": \"5555444433332222\",",
									"    \"cardHolderName\": \"Pedro L√≥pez\",",
									"    \"paymentType\": \"credito\"",
									"};",
									"",
									"const base64Encoded = btoa(JSON.stringify(cardData));",
									"pm.variables.set('encryptedCardData', base64Encoded);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Procesa un pago solo con campos obligatorios.\n\n**Datos encriptados** (solo obligatorios):\n- cardNumber: 5555444433332222\n- cardHolderName: Pedro L√≥pez\n- paymentType: credito\n\n**Nota**: Sin expirationDate, cvv, ni installments (se usan valores por defecto)."
					},
					"response": []
				}
			],
			"description": "Endpoints para procesamiento de pagos con tarjetas."
		},
		{
			"name": "Error Cases",
			"item": [
				{
					"name": "Error - Cart Not Found",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error code is ED-CAR-01\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.errorCode).to.equal('ED-CAR-01');",
									"});",
									"",
									"pm.test(\"Failure is true\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.failure).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"1234567812345678\",",
									"    \"cardHolderName\": \"Test User\",",
									"    \"paymentType\": \"credito\"",
									"};",
									"pm.variables.set('encryptedCardData', btoa(JSON.stringify(cardData)));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": 99999,\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Intenta procesar un pago con un carrito inexistente.\n\n**Error esperado**: ED-CAR-01 - Carrito no encontrado"
					},
					"response": [
						{
							"name": "Cart Not Found",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"cartId\": 99999,\n  \"encryptedCardData\": \"eyJjYXJkTnVtYmVyIjoiMTIzNDU2NzgxMjM0NTY3OCIsImNhcmRIb2xkZXJOYW1lIjoiVGVzdCBVc2VyIiwicGF5bWVudFR5cGUiOiJjcmVkaXRvIn0=\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/payments/process",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"payments",
										"process"
									]
								}
							},
							"status": "Bad Request",
							"code": 400,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"failure\": true,\n  \"code\": 400,\n  \"errorCode\": \"ED-CAR-01\",\n  \"message\": \"[ED-CAR-01] Carrito no encontrado\",\n  \"timestamp\": \"1731506600000\"\n}"
						}
					]
				},
				{
					"name": "Error - Invalid Encrypted Data",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error code is ED-PAY-02\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.errorCode).to.equal('ED-PAY-02');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"INVALID_BASE64_STRING!!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Intenta procesar un pago con datos Base64 inv√°lidos.\n\n**Error esperado**: ED-PAY-02 - Datos encriptados inv√°lidos"
					},
					"response": [
						{
							"name": "Invalid Encrypted Data",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"cartId\": 1,\n  \"encryptedCardData\": \"INVALID_BASE64_STRING!!!\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/payments/process",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"payments",
										"process"
									]
								}
							},
							"status": "Bad Request",
							"code": 400,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"failure\": true,\n  \"code\": 400,\n  \"errorCode\": \"ED-PAY-02\",\n  \"message\": \"[ED-PAY-02] Los datos encriptados de la tarjeta son inv√°lidos\",\n  \"timestamp\": \"1731506700000\"\n}"
						}
					]
				},
				{
					"name": "Error - Invalid Payment Type",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"1234567812345678\",",
									"    \"cardHolderName\": \"Test User\",",
									"    \"paymentType\": \"efectivo\"",
									"};",
									"pm.variables.set('encryptedCardData', btoa(JSON.stringify(cardData)));"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Error code is ED-PAY-04\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.errorCode).to.equal('ED-PAY-04');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Intenta procesar un pago con tipo de pago inv√°lido.\n\n**Datos encriptados**: paymentType = \"efectivo\"\n**Error esperado**: ED-PAY-04 - Tipo de pago inv√°lido"
					},
					"response": [
						{
							"name": "Invalid Payment Type",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"cartId\": 1,\n  \"encryptedCardData\": \"eyJjYXJkTnVtYmVyIjoiMTIzNDU2NzgxMjM0NTY3OCIsImNhcmRIb2xkZXJOYW1lIjoiVGVzdCBVc2VyIiwicGF5bWVudFR5cGUiOiJlZmVjdGl2byJ9\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}/api/v1/payments/process",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v1",
										"payments",
										"process"
									]
								}
							},
							"status": "Bad Request",
							"code": 400,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"failure\": true,\n  \"code\": 400,\n  \"errorCode\": \"ED-PAY-04\",\n  \"message\": \"[ED-PAY-04] Tipo de pago inv√°lido. Debe ser 'debito' o 'credito'\",\n  \"timestamp\": \"1731506800000\"\n}"
						}
					]
				},
				{
					"name": "Error - Invalid Card Number",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const cardData = {",
									"    \"cardNumber\": \"123456\",",
									"    \"cardHolderName\": \"Test User\",",
									"    \"paymentType\": \"credito\"",
									"};",
									"pm.variables.set('encryptedCardData', btoa(JSON.stringify(cardData)));"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Error code is ED-PAY-12\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.errorCode).to.equal('ED-PAY-12');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cartId\": {{cartId}},\n  \"encryptedCardData\": \"{{encryptedCardData}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/payments/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"process"
							]
						},
						"description": "Intenta procesar un pago con n√∫mero de tarjeta inv√°lido (menos de 16 d√≠gitos).\n\n**Datos encriptados**: cardNumber = \"123456\"\n**Error esperado**: ED-PAY-12 - N√∫mero de tarjeta inv√°lido"
					},
					"response": []
				}
			],
			"description": "Casos de error para validar el manejo de excepciones."
		},
		{
			"name": "Utilities",
			"item": [
				{
					"name": "Base64 Encoder (Helper)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===============================================",
									"// üîê HELPER: Codificador Base64 para Tarjetas",
									"// ===============================================",
									"",
									"// Modificar estos datos seg√∫n necesites",
									"const cardData = {",
									"    \"cardNumber\": \"1234567812345678\",",
									"    \"cardHolderName\": \"Juan P√©rez\",",
									"    \"expirationDate\": \"12/25\",",
									"    \"cvv\": \"123\",",
									"    \"installments\": 3,",
									"    \"paymentType\": \"credito\"",
									"};",
									"",
									"// Convertir a JSON",
									"const jsonString = JSON.stringify(cardData, null, 2);",
									"",
									"// Codificar en Base64",
									"const base64Encoded = btoa(JSON.stringify(cardData));",
									"",
									"// Mostrar resultados",
									"console.log('='.repeat(50));",
									"console.log('üìã CARD DATA (JSON):');",
									"console.log('='.repeat(50));",
									"console.log(jsonString);",
									"console.log('');",
									"console.log('='.repeat(50));",
									"console.log('üîê BASE64 ENCODED:');",
									"console.log('='.repeat(50));",
									"console.log(base64Encoded);",
									"console.log('');",
									"console.log('‚úÖ Copia el Base64 y √∫salo en encryptedCardData');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"health"
							]
						},
						"description": "**Helper para generar datos Base64**\n\n1. Abre el Pre-request Script\n2. Modifica el objeto `cardData`\n3. Env√≠a la request (o solo ejecuta el script)\n4. Copia el Base64 de la consola\n5. √ösalo en el campo `encryptedCardData`\n\n**Nota**: Esta request es solo para generar el Base64. El endpoint llamado es irrelevante."
					},
					"response": []
				}
			],
			"description": "Utilidades para facilitar las pruebas."
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global: Se ejecuta antes de cada request",
					"",
					"// Verificar variables de entorno requeridas",
					"const requiredVars = ['base_url', 'token', 'cartId'];",
					"const missingVars = requiredVars.filter(varName => !pm.environment.get(varName));",
					"",
					"if (missingVars.length > 0) {",
					"    console.warn('‚ö†Ô∏è Variables de entorno faltantes:', missingVars.join(', '));",
					"    console.warn('‚ö†Ô∏è Configura estas variables para usar la colecci√≥n correctamente.');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global: Se ejecuta despu√©s de cada request",
					"",
					"// Test global: Verificar que la respuesta tenga formato JSON",
					"pm.test(\"Response is JSON\", function () {",
					"    pm.response.to.be.json;",
					"});",
					"",
					"// Test global: Verificar tiempo de respuesta",
					"pm.test(\"Response time is less than 3000ms\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(3000);",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string"
		},
		{
			"key": "cartId",
			"value": "1",
			"type": "string"
		},
		{
			"key": "paymentId",
			"value": "",
			"type": "string"
		},
		{
			"key": "referenceNumber",
			"value": "",
			"type": "string"
		}
	]
}

