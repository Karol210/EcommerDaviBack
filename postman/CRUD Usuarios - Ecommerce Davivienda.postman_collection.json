{
	"info": {
		"_postman_id": "999dad9f-cca0-437e-8759-96001ee27924",
		"name": "CRUD Usuarios - Ecommerce Davivienda",
		"description": "Colecci√≥n de endpoints para operaciones completas sobre usuarios del sistema.\n\n## üéØ Funcionalidades\n\n1. ‚úÖ **Crear Usuario**: Registro de nuevos usuarios (p√∫blico)\n2. ‚úÖ **Actualizar Usuario**: Modificaci√≥n de datos (requiere JWT)\n3. ‚úÖ **Cambiar Contrase√±a**: P√∫blico y autenticado\n4. ‚úÖ **Obtener Todos los Usuarios**: Lista completa sin datos sensibles ‚≠ê NUEVO\n5. ‚úÖ **Buscar por N√∫mero de Transacci√≥n**: Consulta espec√≠fica por usuarioRolId ‚≠ê NUEVO\n6. ‚úÖ **Buscar por ID**: Consulta espec√≠fica por usuarioId ‚≠ê NUEVO\n\n## üîê Autenticaci√≥n\n\n- ‚ùå **P√∫blico**: Crear usuario, Recuperar contrase√±a, GET all, GET por transactionNumber, GET por ID\n- ‚úÖ **JWT Requerido**: Actualizar usuario, Cambiar contrase√±a autenticado\n\n## üÜï Novedades v2.0\n\n- GET `/api/v1/users/all`: Obtener todos los usuarios del sistema\n- GET `/api/v1/users/transaction/{transactionNumber}`: Buscar usuario por usuarioRolId\n- GET `/api/v1/users/{id}`: Buscar usuario por usuarioId\n- Tests autom√°ticos en todos los endpoints de consulta\n- Validaci√≥n de no retornar contrase√±as\n\n## üìã Variables de Entorno\n\n- `baseUrl`: URL base del API (ej: http://localhost:8080)\n- `token`: Token JWT de autenticaci√≥n\n- `userId`: ID del usuario (usuarioId) para consultas\n- `transactionNumber`: N√∫mero de transacci√≥n (usuarioRolId) para consultas",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "18867414",
		"_collection_link": "https://ecommers-2960.postman.co/workspace/ecommer~52306ab3-2e24-474b-bbb0-b016a3973e77/collection/18867414-999dad9f-cca0-437e-8759-96001ee27924?action=share&source=collection_link&creator=18867414"
	},
	"item": [
		{
			"name": "1. Crear Usuario",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Juan Carlos\",\n    \"apellido\": \"P√©rez Gonz√°lez\",\n    \"documentTypeId\": 1,\n    \"documentNumber\": \"120324567890\",\n    \"email\": \"juan.peregsz@example.com\",\n    \"password\": \"Password123!\",\n    \"roleIds\": [2,3]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un nuevo usuario en el sistema con estado 'Activo' por defecto.\n\n**Validaciones:**\n- Email √∫nico\n- Combinaci√≥n tipo+n√∫mero documento √∫nica\n- Contrase√±a obligatoria\n- Tipo documento y rol deben existir"
			},
			"response": []
		},
		{
			"name": "2.1 Actualizar Usuario Completo",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Juan Carlos Actualizado\",\n    \"apellido\": \"P√©rez Gonz√°lez\",\n    \"status\": \"Inactivo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza todos los campos de un usuario existente.\n\n**Nota:** Todos los campos son opcionales excepto el ID."
			},
			"response": []
		},
		{
			"name": "3. Recuperar Contrase√±a (P√öBLICO)",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"juan.perez@example.com\",\n    \"newPassword\": \"NewPassword456!\",\n    \"envioCorreo\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"change-password"
					]
				},
				"description": "Recuperaci√≥n de contrase√±a (P√öBLICO - sin autenticaci√≥n).\nCambia la contrase√±a y env√≠a correo de notificaci√≥n si envioCorreo=true.\n\n**Validaciones:**\n- Email debe ser v√°lido\n- Usuario debe existir\n- Nueva contrase√±a no puede estar vac√≠a\n\n**Nota:**\n- NO requiere token JWT\n- La contrase√±a se encripta autom√°ticamente con BCrypt\n- envioCorreo=true: Env√≠a correo (default)\n- envioCorreo=false: Solo cambia contrase√±a sin notificaci√≥n"
			},
			"response": []
		},
		{
			"name": "4. Cambiar Contrase√±a Autenticado (PRIVADO)",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"juan.perez@example.com\",\n    \"newPassword\": \"NewPassword999!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/change-password-authenticated",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"change-password-authenticated"
					]
				},
				"description": "Cambio de contrase√±a (PRIVADO - requiere autenticaci√≥n).\nValida que el usuario autenticado sea el due√±o del email.\n\n**Validaciones:**\n- REQUIERE token JWT v√°lido\n- Email debe ser v√°lido\n- Email debe coincidir con el del token\n- Usuario debe existir\n- Nueva contrase√±a no puede estar vac√≠a\n\n**Nota:**\n- La contrase√±a se encripta autom√°ticamente con BCrypt\n- Solo el usuario autenticado puede cambiar su propia contrase√±a"
			},
			"response": []
		},
		{
			"name": "5. Obtener Todos los Usuarios",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has correct structure\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('failure');",
							"    pm.expect(jsonData).to.have.property('code');",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData).to.have.property('body');",
							"    pm.expect(jsonData).to.have.property('timestamp');",
							"});",
							"",
							"pm.test(\"Users found successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.failure).to.be.false;",
							"    pm.expect(jsonData.code).to.equal(200);",
							"    pm.expect(jsonData.message).to.equal('Usuarios encontrados exitosamente');",
							"});",
							"",
							"pm.test(\"Body is an array of users\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.body).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Each user has required fields\", function () {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.body.length > 0) {",
							"        const user = jsonData.body[0];",
							"        pm.expect(user).to.have.property('usuarioId');",
							"        pm.expect(user).to.have.property('nombre');",
							"        pm.expect(user).to.have.property('apellido');",
							"        pm.expect(user).to.have.property('email');",
							"        pm.expect(user).to.have.property('documentType');",
							"        pm.expect(user).to.have.property('documentNumber');",
							"        pm.expect(user).to.have.property('status');",
							"        pm.expect(user).to.have.property('roles');",
							"        pm.expect(user).to.have.property('usuarioRolId');",
							"        pm.expect(user).to.not.have.property('contrasena');",
							"        pm.expect(user).to.not.have.property('password');",
							"    }",
							"});",
							"",
							"// Guardar el usuarioRolId del primer usuario para otros tests",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    if (jsonData.body.length > 0) {",
							"        pm.environment.set('transactionNumber', jsonData.body[0].usuarioRolId);",
							"        console.log('‚úÖ Transaction Number guardado:', jsonData.body[0].usuarioRolId);",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/all",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"all"
					]
				},
				"description": "Obtiene todos los usuarios del sistema.\nRetorna informaci√≥n p√∫blica sin datos sensibles como contrase√±as.\n\n**Campos retornados:**\n- usuarioId: ID √∫nico del usuario\n- nombre: Nombre del usuario\n- apellido: Apellido del usuario\n- documentType: Tipo de documento (nombre completo)\n- documentNumber: N√∫mero de documento\n- email: Correo electr√≥nico\n- status: Estado del usuario (Activo, Inactivo, etc.)\n- roles: Lista de roles asignados\n- usuarioRolId: N√∫mero de transacci√≥n del usuario\n- creationDate: Fecha de creaci√≥n\n\n**Nota:**\n- NO requiere autenticaci√≥n\n- NO retorna contrase√±as ni informaci√≥n sensible\n- Retorna todos los usuarios activos e inactivos"
			},
			"response": []
		},
		{
			"name": "7. Buscar Usuario me",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has correct structure\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('failure');",
							"    pm.expect(jsonData).to.have.property('code');",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData).to.have.property('body');",
							"    pm.expect(jsonData).to.have.property('timestamp');",
							"});",
							"",
							"pm.test(\"User found successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.failure).to.be.false;",
							"    pm.expect(jsonData.code).to.equal(200);",
							"    pm.expect(jsonData.message).to.equal('Usuario encontrado exitosamente');",
							"});",
							"",
							"pm.test(\"Body contains user data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.body).to.be.an('object');",
							"    pm.expect(jsonData.body).to.have.property('usuarioId');",
							"    pm.expect(jsonData.body).to.have.property('nombre');",
							"    pm.expect(jsonData.body).to.have.property('apellido');",
							"    pm.expect(jsonData.body).to.have.property('email');",
							"    pm.expect(jsonData.body).to.have.property('documentType');",
							"    pm.expect(jsonData.body).to.have.property('documentNumber');",
							"    pm.expect(jsonData.body).to.have.property('status');",
							"    pm.expect(jsonData.body).to.have.property('roles');",
							"    pm.expect(jsonData.body).to.have.property('usuarioRolId');",
							"});",
							"",
							"pm.test(\"User does not contain sensitive data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.body).to.not.have.property('contrasena');",
							"    pm.expect(jsonData.body).to.not.have.property('password');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJqdWFuLnBlcmV6OUBleGFtcGxlLmNvbSIsImF1dGhvcml0aWVzIjoiW3tcImF1dGhvcml0eVwiOlwiQ2xpZW50ZVwifV0iLCJ1c2VybmFtZSI6Imp1YW4ucGVyZXo5QGV4YW1wbGUuY29tIiwiZXhwIjoxNzYzMDg0ODU2LCJpYXQiOjE3NjMwODEyNTZ9.yXz61PNk_4LkQfeirWfuoQnzlcL9r9_qHIla7c9ac1Y",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"me"
					]
				},
				"description": "Busca un usuario por su ID (usuarioId).\n\n**Par√°metros:**\n- userId: ID del usuario (usuarioId)\n\n**Campos retornados:**\n- usuarioId: ID √∫nico del usuario\n- nombre: Nombre del usuario\n- apellido: Apellido del usuario\n- documentType: Tipo de documento (nombre completo)\n- documentNumber: N√∫mero de documento\n- email: Correo electr√≥nico\n- status: Estado del usuario (Activo, Inactivo, etc.)\n- roles: Lista de roles asignados\n- usuarioRolId: N√∫mero de transacci√≥n del usuario\n- creationDate: Fecha de creaci√≥n\n\n**Errores:**\n- 404: Usuario no encontrado (ED-USR-01)\n\n**Nota:**\n- NO requiere autenticaci√≥n\n- NO retorna contrase√±as ni informaci√≥n sensible"
			},
			"response": []
		},
		{
			"name": "7. Buscar Usuario por ID",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has correct structure\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('failure');",
							"    pm.expect(jsonData).to.have.property('code');",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData).to.have.property('body');",
							"    pm.expect(jsonData).to.have.property('timestamp');",
							"});",
							"",
							"pm.test(\"User found successfully\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.failure).to.be.false;",
							"    pm.expect(jsonData.code).to.equal(200);",
							"    pm.expect(jsonData.message).to.equal('Usuario encontrado exitosamente');",
							"});",
							"",
							"pm.test(\"Body contains user data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.body).to.be.an('object');",
							"    pm.expect(jsonData.body).to.have.property('usuarioId');",
							"    pm.expect(jsonData.body).to.have.property('nombre');",
							"    pm.expect(jsonData.body).to.have.property('apellido');",
							"    pm.expect(jsonData.body).to.have.property('email');",
							"    pm.expect(jsonData.body).to.have.property('documentType');",
							"    pm.expect(jsonData.body).to.have.property('documentNumber');",
							"    pm.expect(jsonData.body).to.have.property('status');",
							"    pm.expect(jsonData.body).to.have.property('roles');",
							"    pm.expect(jsonData.body).to.have.property('usuarioRolId');",
							"});",
							"",
							"pm.test(\"User does not contain sensitive data\", function () {",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.body).to.not.have.property('contrasena');",
							"    pm.expect(jsonData.body).to.not.have.property('password');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJqdWFuLnBlcmV6OUBleGFtcGxlLmNvbSIsImF1dGhvcml0aWVzIjoiW3tcImF1dGhvcml0eVwiOlwiQ2xpZW50ZVwifV0iLCJ1c2VybmFtZSI6Imp1YW4ucGVyZXo5QGV4YW1wbGUuY29tIiwiZXhwIjoxNzYzMDg0ODU2LCJpYXQiOjE3NjMwODEyNTZ9.yXz61PNk_4LkQfeirWfuoQnzlcL9r9_qHIla7c9ac1Y",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/{{userId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"{{userId}}"
					]
				},
				"description": "Busca un usuario por su ID (usuarioId).\n\n**Par√°metros:**\n- userId: ID del usuario (usuarioId)\n\n**Campos retornados:**\n- usuarioId: ID √∫nico del usuario\n- nombre: Nombre del usuario\n- apellido: Apellido del usuario\n- documentType: Tipo de documento (nombre completo)\n- documentNumber: N√∫mero de documento\n- email: Correo electr√≥nico\n- status: Estado del usuario (Activo, Inactivo, etc.)\n- roles: Lista de roles asignados\n- usuarioRolId: N√∫mero de transacci√≥n del usuario\n- creationDate: Fecha de creaci√≥n\n\n**Errores:**\n- 404: Usuario no encontrado (ED-USR-01)\n\n**Nota:**\n- NO requiere autenticaci√≥n\n- NO retorna contrase√±as ni informaci√≥n sensible"
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "userId",
			"value": "5",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string",
			"description": "Token JWT obtenido del login"
		},
		{
			"key": "transactionNumber",
			"value": "1",
			"type": "string",
			"description": "N√∫mero de transacci√≥n (usuarioRolId) para buscar usuarios"
		}
	]
}