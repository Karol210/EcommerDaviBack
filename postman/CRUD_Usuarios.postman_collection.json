{
	"info": {
		"_postman_id": "crud-usuarios-ecommerce-davivienda",
		"name": "CRUD Usuarios - Ecommerce Davivienda",
		"description": "Colección de endpoints para operaciones sobre usuarios del sistema.\n\n**Notas importantes:**\n- Los requests soportan campos duales para compatibilidad:\n  - `documentType` (string: \"CC\", \"Pasaporte\") O `documentTypeId` (int: 1, 2)\n  - `roles` (lista strings: [\"Cliente\", \"Administrador\"]) O `roleIds` (lista ints: [1, 2])\n  - `status` (string: \"Activo\", \"Inactivo\") O `statusId` (int: 1, 2)\n- Actualización de usuario: ID opcional (si no se envía, actualiza usuario del token JWT)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Crear Usuario (Formato Nuevo - Strings)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Juan Carlos\",\n    \"apellido\": \"Pérez González\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"juan.perez@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"],\n    \"status\": \"Activo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un nuevo usuario usando el formato nuevo (strings).\n\n**Formato Nuevo (Recomendado):**\n- `documentType`: String con código del tipo de documento (\"CC\", \"TI\", \"CE\", \"PA\")\n- `roles`: Lista de strings con nombres de roles ([\"Cliente\"], [\"Administrador\"])\n- `status`: String con nombre del estado (\"Activo\", \"Inactivo\", \"Suspendido\", \"Bloqueado\")\n\n**Validaciones:**\n- Email único\n- Combinación tipo+número documento única\n- Contraseña obligatoria\n- Tipo documento y roles deben existir\n- Estado opcional (se asigna \"Activo\" por defecto)"
			},
			"response": []
		},
		{
			"name": "1.1 Crear Usuario (Formato Antiguo - IDs)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"María\",\n    \"apellido\": \"García López\",\n    \"documentTypeId\": 1,\n    \"documentNumber\": \"9876543210\",\n    \"email\": \"maria.garcia@admin.com\",\n    \"password\": \"Admin123!\",\n    \"roleIds\": [1],\n    \"statusId\": 1\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un usuario usando el formato antiguo (IDs) - DEPRECADO pero soportado.\n\n**Formato Antiguo (Compatibilidad):**\n- `documentTypeId`: Integer con ID del tipo de documento\n- `roleIds`: Lista de integers con IDs de roles\n- `statusId`: Integer con ID del estado\n\n**Nota:** Se recomienda usar el formato nuevo con strings."
			},
			"response": []
		},
		{
			"name": "1.2 Crear Usuario Admin",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Admin\",\n    \"apellido\": \"Sistema\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1111111111\",\n    \"email\": \"admin@davivienda.com\",\n    \"password\": \"Admin123!\",\n    \"roles\": [\"Administrador\"],\n    \"status\": \"Activo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un usuario con rol ADMIN para pruebas de autorización."
			},
			"response": []
		},
		{
			"name": "1.3 Crear Usuario Vendedor",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Pedro\",\n    \"apellido\": \"Martínez Silva\",\n    \"documentType\": \"PA\",\n    \"documentNumber\": \"AB123456\",\n    \"email\": \"pedro.martinez@vendedor.com\",\n    \"password\": \"Vendedor123!\",\n    \"roles\": [\"Vendedor\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un usuario con rol VENDEDOR.\n\n**Nota:** No se especifica status, se asigna \"Activo\" por defecto."
			},
			"response": []
		},
		{
			"name": "1.4 Crear Usuario Multi-Rol",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Carlos\",\n    \"apellido\": \"Rodríguez\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"3333333333\",\n    \"email\": \"carlos.rodriguez@multi.com\",\n    \"password\": \"Multi123!\",\n    \"roles\": [\"Cliente\", \"Vendedor\"],\n    \"status\": \"Activo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Crea un usuario con múltiples roles.\n\n**Nota:** El sistema valida que la combinación de roles sea válida."
			},
			"response": []
		},
		{
			"name": "2. Actualizar Usuario Autenticado (Sin ID)",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Juan Carlos Actualizado\",\n    \"apellido\": \"Pérez González\",\n    \"email\": \"juan.perez.updated@example.com\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza el usuario autenticado del token JWT (sin especificar ID).\n\n**REQUIERE token JWT válido**\n\n**Importante:** \n- Si NO se envía ID, actualiza el usuario del token JWT\n- Todos los campos son opcionales\n- Los campos que sean null no se actualizarán (se mantendrá el valor existente)\n\n**Validaciones:**\n- Si cambia email, debe ser único\n- Si cambia documento, combinación debe ser única"
			},
			"response": []
		},
		{
			"name": "2.1 Actualizar Usuario Por ID",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 5,\n    \"nombre\": \"Juan Carlos Actualizado\",\n    \"apellido\": \"Pérez González\",\n    \"email\": \"juan.perez.updated@example.com\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza un usuario específico por ID.\n\n**REQUIERE token JWT válido**\n\n**Importante:** \n- Si se envía ID, valida ownership (solo puede actualizar sus propios datos)\n- Todos los campos son opcionales excepto ID\n- Los campos que sean null no se actualizarán"
			},
			"response": []
		},
		{
			"name": "2.2 Actualizar Usuario Completo (Formato Nuevo)",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 5,\n    \"nombre\": \"Juan Carlos Actualizado\",\n    \"apellido\": \"Pérez González\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"juan.perez.updated@example.com\",\n    \"roles\": [\"Cliente\"],\n    \"status\": \"Activo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza todos los campos de un usuario usando formato nuevo (strings).\n\n**Nota:** Todos los campos son opcionales. Solo se actualizan los campos enviados."
			},
			"response": []
		},
		{
			"name": "2.3 Actualizar Usuario Completo (Formato Antiguo)",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 5,\n    \"nombre\": \"Juan Carlos Actualizado\",\n    \"apellido\": \"Pérez González\",\n    \"documentTypeId\": 1,\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"juan.perez.updated@example.com\",\n    \"roleIds\": [2],\n    \"statusId\": 1\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza todos los campos de un usuario usando formato antiguo (IDs) - DEPRECADO.\n\n**Nota:** Se recomienda usar formato nuevo con strings."
			},
			"response": []
		},
		{
			"name": "2.4 Actualizar Solo Roles",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 5,\n    \"roles\": [\"Cliente\", \"Vendedor\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza solo los roles de un usuario.\n\n**Nota:** Los demás campos se mantienen sin cambios."
			},
			"response": []
		},
		{
			"name": "2.5 Actualizar Solo Estado",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 5,\n    \"status\": \"Inactivo\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Actualiza solo el estado de un usuario.\n\n**Estados válidos:** Activo, Inactivo, Suspendido, Bloqueado"
			},
			"response": []
		},
		{
			"name": "3. Recuperar Contraseña (PÚBLICO)",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"juan.perez@example.com\",\n    \"newPassword\": \"NewPassword456!\",\n    \"envioCorreo\": true\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"change-password"
					]
				},
				"description": "Recuperación de contraseña (PÚBLICO - sin autenticación).\nCambia la contraseña y envía correo de notificación si envioCorreo=true.\n\n**Validaciones:**\n- Email debe ser válido\n- Usuario debe existir\n- Nueva contraseña no puede estar vacía\n\n**Nota:**\n- NO requiere token JWT\n- La contraseña se encripta automáticamente con BCrypt\n- `envioCorreo=true`: Envía correo (default)\n- `envioCorreo=false`: Solo cambia contraseña sin notificación"
			},
			"response": []
		},
		{
			"name": "3.1 Recuperar Contraseña Sin Correo",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"juan.perez@example.com\",\n    \"newPassword\": \"NewPassword789!\",\n    \"envioCorreo\": false\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/change-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"change-password"
					]
				},
				"description": "Recuperación de contraseña sin envío de correo.\nSolo cambia la contraseña sin notificar al usuario."
			},
			"response": []
		},
		{
			"name": "4. Cambiar Contraseña Autenticado (PRIVADO)",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"juan.perez@example.com\",\n    \"newPassword\": \"NewPassword999!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/change-password-authenticated",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"change-password-authenticated"
					]
				},
				"description": "Cambio de contraseña (PRIVADO - requiere autenticación).\nValida que el usuario autenticado sea el dueño del email.\n\n**Validaciones:**\n- REQUIERE token JWT válido\n- Email debe ser válido\n- Email debe coincidir con el del token\n- Usuario debe existir\n- Nueva contraseña no puede estar vacía\n\n**Nota:**\n- La contraseña se encripta automáticamente con BCrypt\n- Solo el usuario autenticado puede cambiar su propia contraseña"
			},
			"response": []
		},
		{
			"name": "Error - Correo Duplicado",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Usuario\",\n    \"apellido\": \"Duplicado\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"9999999999\",\n    \"email\": \"juan.perez@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con un correo que ya existe.\n\n**Error esperado:** ED-USR-04 - El correo electrónico ya está registrado"
			},
			"response": []
		},
		{
			"name": "Error - Documento Duplicado",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Usuario\",\n    \"apellido\": \"Duplicado\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"usuario.duplicado@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con una combinación tipo+número de documento que ya existe.\n\n**Error esperado:** ED-USR-05 - La combinación de tipo de documento y número de documento ya está registrada"
			},
			"response": []
		},
		{
			"name": "Error - Validación Campos",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"J\",\n    \"apellido\": \"P\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"123\",\n    \"email\": \"email-invalido\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con campos inválidos.\n\n**Errores esperados:**\n- Nombre/Apellido: mínimo 2 caracteres\n- Documento: mínimo 5 caracteres\n- Email: formato inválido"
			},
			"response": []
		},
		{
			"name": "Error - Usuario No Encontrado (Update)",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"description": "Token JWT obtenido del login"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"id\": 99999,\n    \"nombre\": \"Usuario Inexistente\",\n    \"email\": \"inexistente@example.com\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/update",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"update"
					]
				},
				"description": "Intenta actualizar un usuario con ID inexistente.\n\n**Error esperado:** ED-USR-01 - Usuario no encontrado"
			},
			"response": []
		},
		{
			"name": "Error - Tipo Documento No Encontrado",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Usuario\",\n    \"apellido\": \"Test\",\n    \"documentType\": \"INVALIDO\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con tipo de documento que no existe.\n\n**Error esperado:** ED-DOC-01 - Tipo de documento no encontrado"
			},
			"response": []
		},
		{
			"name": "Error - Rol No Encontrado",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Usuario\",\n    \"apellido\": \"Test\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"RolInvalido\"]\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con rol que no existe.\n\n**Error esperado:** ED-ROL-01 - Rol no encontrado"
			},
			"response": []
		},
		{
			"name": "Error - Estado No Encontrado",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"nombre\": \"Usuario\",\n    \"apellido\": \"Test\",\n    \"documentType\": \"CC\",\n    \"documentNumber\": \"1234567890\",\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!\",\n    \"roles\": [\"Cliente\"],\n    \"status\": \"EstadoInvalido\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/users/create",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"users",
						"create"
					]
				},
				"description": "Intenta crear un usuario con estado que no existe.\n\n**Error esperado:** ED-STA-01 - Estado de usuario no encontrado"
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "userId",
			"value": "5",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string",
			"description": "Token JWT obtenido del login"
		}
	]
}
