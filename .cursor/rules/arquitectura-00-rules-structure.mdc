---
description: Estructura estÃ¡ndar para reglas de Cursor - Principios anti-redundancia
globs: ["**/*.mdc"]
alwaysApply: true
---

# ğŸ“ Estructura de Reglas de Cursor

## ğŸ“‹ TL;DR

- âœ… Estructura estÃ¡ndar con 7 secciones mÃ¡ximo
- âœ… Max 400 lÃ­neas (300 ideal)
- âœ… Tablas sobre ejemplos largos
- âŒ NO repetir informaciÃ³n entre archivos
- âŒ NO ejemplos obvios

## ğŸ¯ ESTRUCTURA OBLIGATORIA

```markdown
---
description: Max 100 caracteres
globs: ["**/*.ext"]
alwaysApply: true/false
---

# ğŸ”§ [TÃ­tulo]

## ğŸ“‹ TL;DR
- 3-5 bullets esenciales

## ğŸš¨ Reglas Principales
[MÃ¡ximo 5 reglas concisas]

## ğŸ“Š Referencia RÃ¡pida
[Tabla con patrones esenciales]

## âœ… Ejemplos
[Solo NO obvios, mÃ¡ximo 3]

## ğŸš« Restricciones
[Lista numerada, mÃ¡ximo 10]

## âœ… ValidaciÃ³n AutomÃ¡tica
[QuÃ© debe detectar Cursor]

## ğŸ¯ Objetivo + Regla de Oro
[1-2 lÃ­neas + frase memorable]
```

## ğŸš« ANTI-PATRONES CRÃTICOS

### âŒ Repetir Ejemplos
```markdown
<!-- âŒ MAL - 4 variantes casi idÃ©nticas -->
### Ejemplo Normal
[50 lÃ­neas de cÃ³digo]
### Ejemplo Bold  
[50 lÃ­neas casi iguales]
### Ejemplo Error
[50 lÃ­neas casi iguales]

<!-- âœ… BIEN - Tabla + 1 ejemplo -->
| Variante | Clase | Uso |
|----------|-------|-----|
| Normal | `.class` | Uso normal |
| Bold | `.class--bold` | Ã‰nfasis |

[1 ejemplo base + nota de variantes]
```

### âŒ Duplicar Entre Archivos
```markdown
<!-- âŒ MAL - Copiar contenido completo -->

<!-- âœ… BIEN - Referenciar -->
> Ver [componentes-01-primeng-forms.mdc](./componentes-01-primeng-forms.mdc#buttons)
```

### âŒ Ejemplos Obvios
```typescript
// âŒ MAL - No agregar
const x = 1;  // Sin tipo

// Solo incluir cuando NO sea obvio por quÃ© estÃ¡ mal
```

## ğŸ“ LÃMITES ESTRICTOS

| Tipo | Max LÃ­neas | AcciÃ³n |
|------|------------|--------|
| Simple | 300 | âœ… Ideal |
| Media | 400 | âš ï¸ MÃ¡ximo |
| Compleja | 500 | ğŸš¨ Refactorizar |

**Al exceder:** Tablas, referencias, eliminar redundancia

## ğŸ“ NOMENCLATURA

**PatrÃ³n:** `[tipo]-[num]-[nombre].mdc`

| Tipo | Contenido |
|------|-----------|
| `documentacion-XX` | JSDoc, DokuWiki |
| `servicios-XX` | APIs, CMS, Storage, DI, DTOs |
| `componentes-XX` | UI, Estilos, Modelos |
| `test-XX` | Jest, E2E |
| `arquitectura-XX` | Estructura, Patrones |

**Nota**: Para reglas de DTOs ver [servicios-05-dtos.mdc](./servicios-05-dtos.mdc)

## ğŸ“ PATRONES DE ORGANIZACIÃ“N

### Estructura Simple vs Organizada vs Modular

| Tipo | CuÃ¡ndo Usar | Ejemplo |
|------|-------------|---------|
| **Simple** | 1 funcionalidad/endpoint | `service/shorturl/` |
| **Organizada** | â‰¥2 ops misma entidad | `service/transaction/detail/` |
| **Modular** â­ | MÃ³dulo completo independiente | `service/processconfig/` + paquetes en todas las capas |

#### 1ï¸âƒ£ Estructura Simple
**Usar cuando:**
- âœ… Una sola funcionalidad/endpoint
- âœ… Dos operaciones muy relacionadas y simples
- âœ… DTOs compartidos entre operaciones

**Ejemplo:**
```
service/shorturl/
dto/shorturl/
```

#### 2ï¸âƒ£ Estructura Organizada
**Usar cuando:**
- âœ… MÃºltiples endpoints sobre la misma entidad (GET, POST, PUT, DELETE)
- âœ… Operaciones con DTOs y lÃ³gica claramente diferenciados
- âœ… Evita colisiÃ³n de nombres entre servicios similares

**Ejemplo:**
```
service/transaction/
â”œâ”€â”€ detail/          # GET - Consulta
â””â”€â”€ step/            # PUT - ActualizaciÃ³n

dto/transaction/
â”œâ”€â”€ detail/          # DTOs de consulta
â””â”€â”€ step/            # DTOs de actualizaciÃ³n
```

#### 3ï¸âƒ£ Estructura Modular â­ **RECOMENDADA**
**Usar cuando:**
- âœ… MÃ³dulo funcional completo e independiente
- âœ… Funcionalidad con controller, service, dto y exception propios
- âœ… Requiere README.md con documentaciÃ³n especÃ­fica
- âœ… Facilita mantenimiento y escalabilidad

**Ejemplo:**
```
controller/processconfig/
â””â”€â”€ ProcessConfigurationController.java

service/processconfig/
â”œâ”€â”€ AllyProcessConfigurationService.java
â”œâ”€â”€ AllyProcessConfigurationServiceImpl.java
â””â”€â”€ README.md

exception/processconfig/
â””â”€â”€ ProcessConfigurationException.java

documents/allies/
â””â”€â”€ WorkFlowAlly.java (reutilizado como respuesta)
    â””â”€â”€ Incluye ControlsValidationDto (actualizado)
```

**ğŸ’¡ Nota:** Se reutilizÃ³ documento MongoDB existente en lugar de crear DTO duplicado.

### ğŸ“‹ Tabla de DecisiÃ³n

| Criterio | Simple | Organizada | Modular |
|----------|:------:|:----------:|:-------:|
| 1 operaciÃ³n | âœ… | âŒ | âŒ |
| â‰¥2 ops misma entidad | âŒ | âœ… | âŒ |
| MÃ³dulo completo | âŒ | âŒ | âœ… |
| Con controller propio | âŒ | âŒ | âœ… |
| Con exception propia | âŒ | âŒ | âœ… |
| Con README.md | âŒ | âŒ | âœ… |

### âŒ Anti-patrÃ³n: Sobre-organizaciÃ³n

**NO crear subcarpetas cuando:**
```
âŒ MAL - Subcarpeta innecesaria
service/payment/
â””â”€â”€ single/              # Solo una operaciÃ³n
    â””â”€â”€ PaymentServiceImpl.java

âœ… BIEN - Estructura simple
service/payment/
â””â”€â”€ PaymentServiceImpl.java
```

**NO crear mÃºltiples niveles de organizaciÃ³n:**
```
âŒ MAL - Demasiados niveles
service/transaction/detail/get/retrieve/
                                      â””â”€â”€ ...

âœ… BIEN - MÃ¡ximo 2 niveles
service/transaction/detail/
                      â””â”€â”€ ...
```

## ğŸ“‚ REGLAS ACTUALES

| CategorÃ­a | Archivo | DescripciÃ³n | LÃ­neas | Estado |
|-----------|---------|-------------|--------|--------|
| ğŸ—ï¸ Arquitectura | `arquitectura-00-rules-structure` | Estructura estÃ¡ndar y anti-redundancia | ~381 | âœ… Actualizada |
| ğŸ”§ Servicios | `servicios-01-creacion-servicios` | Arquitectura en capas + MapStruct + caso real refactorizaciÃ³n | ~1029 | âš ï¸ Refactorizar (excede 500 lÃ­neas) |
| ğŸ”§ Servicios | `servicios-02-feign-client` | IntegraciÃ³n con APIs externas vÃ­a Feign | 186 | âœ… |
| ğŸ”§ Servicios | `servicios-03-feign-config` | ConfiguraciÃ³n transversal de Feign | 189 | âœ… |
| ğŸ”§ Servicios | `servicios-04-excepciones` | Excepciones + paquetes especÃ­ficos | ~370 | âœ… Actualizada |
| ğŸ”§ Servicios | `servicios-05-dtos` | DTOs y Data Transfer Objects | 306 | âœ… |
| ğŸ’¾ Servicios | `servicios-06-transactional` | Capa transactional - Acceso a datos y consultas BD | ~415 | âœ… Actualizada |
| ğŸ” Calidad | `servicios-07-sonar` | SonarQube - Complejidad cognitiva y code smells | 255 | âœ… Estandarizada |
| ğŸ“ DocumentaciÃ³n | `servicios-08-documentacion` | Informes de cambios en DokuWiki + Ejemplos Uso | 223 | âœ… Estandarizada |
| ğŸ”§ Servicios | `servicios-09-organizacion-capacidades` | OrganizaciÃ³n por capacidades + dominios OBLIGATORIO | ~790 | âš ï¸ Refactorizar (excede 500 lÃ­neas) |
| ğŸ§¹ Calidad | `servicios-10-buenas-practicas` | Clean Code - SRP, constantes, mÃ©todos pequeÃ±os | 306 | âœ… Estandarizada |
| ğŸ® Servicios | `servicios-11-controllers` | Controllers REST - Paths descriptivos y mejores prÃ¡cticas | 462 | âš ï¸ Refactorizar |

**Total:** 12 archivos (1 arquitectura + 9 servicios + 2 calidad + 1 documentaciÃ³n)

**Estado de lÃ­mites:**
- âœ… 6 archivos dentro del rango ideal (< 300 lÃ­neas)
- âœ… 3 archivos en rango medio (300-400 lÃ­neas)
- âš ï¸ 3 archivos requieren refactorizaciÃ³n (> 400 lÃ­neas)
- âš ï¸ Promedio: ~410 lÃ­neas por archivo

**Ãšltimas actualizaciones:**
- âœ¨ **Agregado** Ejemplo 4.1 en `servicios-09-organizacion-capacidades` - Caso real User organizado por dominios + REGLA OBLIGATORIA
- âœ¨ **Agregado** Ejemplo 5.1 en `servicios-01-creacion-servicios` - Caso real de refactorizaciÃ³n UserBuilderService â†’ UserMapper con mÃ©tricas
- âœ¨ **Reemplazada** regla de **Transaction** por **Capa Transactional** (`servicios-06-transactional`) - Capacidad dedicada para operaciones de BD
- âœ¨ **Agregada** regla de **Controllers REST** (`servicios-11-controllers`)
- âœ¨ **Estandarizada** regla de **Buenas PrÃ¡cticas** (`servicios-10-buenas-practicas`)
- âœ¨ Integrado "Checklist de RefactorizaciÃ³n" en "ValidaciÃ³n AutomÃ¡tica"
- âœ¨ Agregada regla de **DocumentaciÃ³n DokuWiki** (`servicios-08-documentacion`)
- âœ¨ **SecciÃ³n "Ejemplos de Uso"** obligatoria con curl + responses (Ã©xito + error)
- âœ¨ Agregada **Estructura Modular** para mÃ³dulos completos


### ğŸ“‹ Reglas para Comandos

**âœ… Permitido:**
- Un archivo `.md` por comando con instrucciones claras
- Nombre del comando = nombre del archivo (sin extensiÃ³n)
- Instrucciones detalladas dentro del archivo del comando

**âŒ PROHIBIDO:**
- NO crear archivos `README.md` en carpeta commands
- NO crear archivos `INDEX.md` o similar
- NO crear archivos `USAGE.md` o documentaciÃ³n adicional
- NO duplicar informaciÃ³n entre comandos
- NO crear subcarpetas dentro de commands

**âš ï¸ IMPORTANTE:** 
- Los comandos de Cursor (`.cursor/commands/`) son autodocumentados
- La regla de READMEs para componentes shared (`componentes-06-shared.mdc`) SOLO aplica a `src/app/shared/components/`
- NO aplicar reglas de documentaciÃ³n de cÃ³digo a carpetas de configuraciÃ³n de Cursor

**RazÃ³n:** Los comandos son autodocumentados. El contenido del archivo `.md` es la documentaciÃ³n del comando.

## ğŸ”— REFERENCIAS

```markdown
> Ver [archivo.mdc](./archivo.mdc#seccion)

**EspecÃ­fico aquÃ­:**
- Solo diferencias
```

### Referencias EspecÃ­ficas por Tema

**Para DTOs (Data Transfer Objects):**
> Ver [servicios-05-dtos.mdc](./servicios-05-dtos.mdc) para nomenclatura, estructura de paquetes y validaciones.

**Evitar redundancia sobre:**
- Nomenclatura de DTOs (sufijo `Dto`)
- AgrupaciÃ³n por dominio (`dto/{dominio}/`)
- Estructura organizada por funcionalidad (`dto/{dominio}/{operacion}/`)
- Anotaciones Lombok y Jackson
- Clases separadas vs internas
- MÃ©todos helper en DTOs

**Para Servicios (Service Layer):**
> Ver [servicios-01-creacion-servicios.mdc](./servicios-01-creacion-servicios.mdc) para arquitectura en capas y principios SOLID.

**Evitar redundancia sobre:**
- Tipos de servicios (Principal, Especializado, External, Processor, Retriever)
- Estructura de carpetas por dominio (`service/{dominio}/`)
- Estructura organizada por funcionalidad (`service/{dominio}/{operacion}/`)
- **Estructura modular** (`service/{modulo}/` + paquetes en todas las capas)
- InyecciÃ³n de dependencias por interfaz
- ValidaciÃ³n previa (solicitar URL, CURL, responses JSON)

**Para OrganizaciÃ³n por Capacidades:**
> Ver [servicios-09-organizacion-capacidades.mdc](./servicios-09-organizacion-capacidades.mdc) para organizaciÃ³n de servicios external y DTOs por capacidades.

**Evitar redundancia sobre:**
- SeparaciÃ³n por capacidades (`external/auth/`, `external/questions/`)
- DecisiÃ³n raÃ­z vs subcarpetas (â‰¥2 capacidades â†’ subcarpetas)
- Estructura paralela entre `service/external/` y `dto/`
- Patrones comunes de capacidades (auth, questions, validation, processing, storage)
- Beneficios de alta cohesiÃ³n y bajo acoplamiento

**Para Feign Clients:**
> Ver [servicios-02-feign-client.mdc](./servicios-02-feign-client.mdc) para integraciÃ³n con APIs externas.

**Evitar redundancia sobre:**
- Nomenclatura de clientes (sufijo `-client` en `@FeignClient`, prefijo `External` en interfaz)
- UbicaciÃ³n en `external/` junto con servicios external
- ConfiguraciÃ³n automÃ¡tica desde `FeignClientConfig`
- URL dinÃ¡mica desde `${services.{nombre}.url}`
- API Key opcional desde `${services.{nombre}.api-key}`

**Para Excepciones:**
> Ver [servicios-04-excepciones.mdc](./servicios-04-excepciones.mdc) para manejo de errores personalizados.

**Evitar redundancia sobre:**
- Formato de cÃ³digos de error (`TDTC-XX-NNNN`)
- Estructura de excepciones (campo `errorCode`, dos constructores)
- **Paquetes especÃ­ficos** (`exception/{modulo}/` para mÃ³dulos completos)
- Constantes en `Constants.java`
- Handlers en `ExceptionHandlerController`

**Para Capa Transactional (Acceso a Datos):**
> Ver [servicios-06-transactional.mdc](./servicios-06-transactional.mdc) para capacidad dedicada a operaciones de consulta y persistencia.

**Evitar redundancia sobre:**
- SeparaciÃ³n obligatoria de operaciones de BD en capacidad transactional
- Nomenclatura de mÃ©todos (`find*`, `save*`, `delete*`, `exists*`, `findOrCreate*`)
- Anotaciones `@Transactional` y `@Transactional(readOnly = true)`
- Interface + ImplementaciÃ³n siempre
- ServiceImpl no inyecta repositories directamente

**Para DocumentaciÃ³n de Cambios:**
> Ver [servicios-08-documentacion.mdc](./servicios-08-documentacion.mdc) para informes de cambios en DokuWiki.

**Evitar redundancia sobre:**
- Estructura obligatoria del informe (8 secciones)
- Formato de nombre de archivo
- Secciones prohibidas (Cobertura, Arquitectura, SOLID, etc.)
- Formato de PRs en tablas por ambiente
- AnÃ¡lisis de commits con comandos git

**Para Controllers REST:**
> Ver [servicios-11-controllers.mdc](./servicios-11-controllers.mdc) para endpoints autodocumentados y mejores prÃ¡cticas.

**Evitar redundancia sobre:**
- Paths descriptivos y patrones consistentes (`/create`, `/find-by-id/{id}`, `/update/{id}`)
- Estructura de Response estÃ¡ndar (`failure`, `code`, `message`, `body`, `timestamp`)
- Anotaciones de controllers (`@RestController`, `@RequestMapping`, `@Valid`)
- Validaciones automÃ¡ticas con `@Valid`
- Logs informativos sin datos sensibles
- Status HTTP con `HttpStatus` enum

## ğŸ”— MATRIZ DE DEPENDENCIAS

| Regla | Depende de | Razonamiento |
|-------|------------|--------------|
| `servicios-01-creacion-servicios` | `servicios-02-feign-client`, `servicios-04-excepciones`, `servicios-05-dtos`, `servicios-06-transactional` | Servicios usan Feign Clients, Excepciones, DTOs y capacidad transactional |
| `servicios-02-feign-client` | `servicios-03-feign-config`, `servicios-05-dtos` | Feign Clients usan config transversal y DTOs |
| `servicios-06-transactional` | `servicios-04-excepciones`, `servicios-09-organizacion-capacidades` | Capacidad transactional usa excepciones y sigue organizaciÃ³n por capacidades |
| `servicios-09-organizacion-capacidades` | `servicios-01-creacion-servicios`, `servicios-02-feign-client`, `servicios-05-dtos` | Organiza servicios external y DTOs por capacidades |
| `servicios-11-controllers` | `servicios-01-creacion-servicios`, `servicios-05-dtos`, `servicios-10-buenas-practicas` | Controllers usan servicios, DTOs y principios de clean code |

**Principio:** Cuando una regla depende de otra, usar **referencias** en lugar de duplicar contenido.

## âœ… VALIDACIÃ“N

### Checklist al Crear/Editar Reglas

**Estructura:**
- [ ] Â¿TL;DR con 3-5 bullets?
- [ ] Â¿< 400 lÃ­neas? (300 ideal)
- [ ] Â¿Secciones estÃ¡ndar completas?
- [ ] Â¿Tabla de Referencia RÃ¡pida presente?

**Contenido:**
- [ ] Â¿Sin repetir ejemplos similares?
- [ ] Â¿Sin duplicar contenido de otras reglas?
- [ ] Â¿Referencias en lugar de copiar?
- [ ] Â¿Solo ejemplos NO obvios?
- [ ] Â¿MÃ¡ximo 3 ejemplos de cÃ³digo?

**OrganizaciÃ³n:**
- [ ] Â¿Sin archivos README.md o INDEX.md adicionales?
- [ ] Â¿Sin documentaciÃ³n externa innecesaria?
- [ ] Â¿Referencias cruzadas actualizadas?
- [ ] Â¿ValidaciÃ³n automÃ¡tica definida?

**PROHIBIDO crear:**
- `README.md` en carpetas de reglas
- `INDEX.md` para listar reglas
- Archivos de documentaciÃ³n adicional (`.md` no relacionados con comandos)
- GuÃ­as de uso separadas cuando la regla ya estÃ¡ autodocumentada
- **DocumentaciÃ³n MD para CSS/SCSS** (usar comentarios JSDoc en el cÃ³digo)
- **Archivos MD que expliquen arquitectura de temas o variables CSS**
- **GuÃ­as de migraciÃ³n, limitaciones tÃ©cnicas o resÃºmenes de cambios en MD**

## ğŸ¯ OBJETIVO

Reglas concisas, sin redundancia, fÃ¡ciles de consultar.

**REGLA DE ORO**: "Si puedes usar tabla en lugar de 4 ejemplos, usa tabla. Si puedes referenciar en lugar de copiar, referencia."
