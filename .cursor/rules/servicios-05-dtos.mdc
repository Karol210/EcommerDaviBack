---
description: Reglas para creaci√≥n y organizaci√≥n de DTOs (Data Transfer Objects)
globs: ["**/dto/**/*.java"]
alwaysApply: true
---

# üì¶ DTOs - Data Transfer Objects

## üìã TL;DR

- ‚úÖ Todos los DTOs terminan con sufijo `Dto`
- ‚úÖ Clases SEPARADAS (no internas) para objetos anidados
- ‚úÖ Agrupar por dominio: `dto/{dominio}/`
- ‚úÖ **Si m√∫ltiples operaciones**: usar subcarpetas `dto/{dominio}/{operacion}/`
- ‚úÖ Lombok + Jackson: `@Data`, `@Builder`, `@JsonProperty`, `@JsonIgnoreProperties`, `@JsonInclude`
- ‚úÖ **Consistencia de idiomas**: Todos los campos en espa√±ol O ingl√©s (NO mixto)
- ‚ùå NO l√≥gica de negocio (solo m√©todos helper simples)

## üö® Reglas Principales

1. **Nomenclatura**: Todos terminan con `Dto` (ejemplo: `HealthInsurancePremiumRequestDto`)
2. **Clases Separadas**: Objetos anidados en archivos SEPARADOS (NO clases internas est√°ticas)
3. **Agrupaci√≥n**: Un subpaquete `dto/{dominio}/` por funcionalidad (ejemplo: `dto/healthinsurance/`)
4. **Anotaciones**: Lombok (`@Data`, `@Builder`, `@NoArgsConstructor`, `@AllArgsConstructor`) + Jackson (`@JsonProperty`, `@JsonIgnoreProperties(ignoreUnknown = true)`, `@JsonInclude(JsonInclude.Include.NON_NULL)`)
5. **JavaDoc Completo**: Documentar clase, campos y m√©todos helper
6. **Consistencia de Idiomas**: Todos los campos (variables Java Y `@JsonProperty`) deben estar en un √öNICO idioma por DTO (espa√±ol O ingl√©s, NO mixto)

## üìä Referencia R√°pida

### Nomenclatura por Tipo

| Tipo | Sufijo | Ejemplo | Uso |
|------|--------|---------|-----|
| Request | `RequestDto` | `HealthInsurancePremiumRequestDto` | Input de APIs |
| Response | `ResponseDto` | `HealthInsurancePremiumResponseDto` | Output de APIs |
| Data (anidado) | `DataDto` | `HealthInsurancePremiumDataDto` | Objeto `data` en response |
| Error (anidado) | `ErrorDataDto` | `HealthInsurancePremiumErrorDataDto` | Objeto `error` en response |
| Interno | `Dto` | `ResolvedParametersDto` | Transferencia entre capas |

### Estructura de Paquetes

#### Estructura Simple (Funcionalidad √önica)

```
dto/
‚îú‚îÄ‚îÄ healthinsurance/
‚îÇ   ‚îú‚îÄ‚îÄ HealthInsurancePremiumRequestDto.java
‚îÇ   ‚îú‚îÄ‚îÄ HealthInsurancePremiumResponseDto.java
‚îÇ   ‚îú‚îÄ‚îÄ HealthInsurancePremiumDataDto.java
‚îÇ   ‚îî‚îÄ‚îÄ HealthInsurancePremiumErrorDataDto.java
‚îú‚îÄ‚îÄ shorturl/
‚îÇ   ‚îú‚îÄ‚îÄ ShortUrlRequestDto.java
‚îÇ   ‚îî‚îÄ‚îÄ ShortUrlResponseDto.java
‚îî‚îÄ‚îÄ payment/
    ‚îú‚îÄ‚îÄ PaymentRequestDto.java
    ‚îî‚îÄ‚îÄ PaymentResponseDto.java
```

#### Estructura Organizada (M√∫ltiples Operaciones Relacionadas)

**Cuando existen m√∫ltiples operaciones sobre la misma entidad** (ej: GET, POST, PUT, DELETE de transacciones), organizar en subcarpetas por tipo de operaci√≥n:

```
dto/transaction/
‚îú‚îÄ‚îÄ detail/                                    # GET - Consulta
‚îÇ   ‚îú‚îÄ‚îÄ TransactionDetailResponseDto.java
‚îÇ   ‚îú‚îÄ‚îÄ TransactionDetailBodyDto.java
‚îÇ   ‚îú‚îÄ‚îÄ TransactionDatosDto.java
‚îÇ   ‚îî‚îÄ‚îÄ CiudadDto.java
‚îî‚îÄ‚îÄ step/                                      # PUT - Actualizaci√≥n de pasos
    ‚îú‚îÄ‚îÄ TransactionStepRequestDto.java
    ‚îú‚îÄ‚îÄ TransactionStepResponseDto.java
    ‚îú‚îÄ‚îÄ TransactionStepResponseBodyDto.java
    ‚îú‚îÄ‚îÄ ConsultasDto.java
    ‚îî‚îÄ‚îÄ PasarelaPagosDto.java
```

**Criterios para usar subcarpetas:**
- ‚úÖ M√∫ltiples endpoints sobre la misma entidad con DTOs distintos
- ‚úÖ Operaciones GET, POST, PUT, DELETE claramente diferenciadas
- ‚úÖ Evita mezclar DTOs de diferentes operaciones
- ‚úÖ Facilita mantenimiento y escalabilidad
- ‚ùå NO usar si solo hay una operaci√≥n o todos los DTOs son muy simples

### Orden de Anotaciones Est√°ndar

```java
@Data                                               // 1. Lombok Data
@Builder                                            // 2. Builder pattern
@NoArgsConstructor                                  // 3. Constructor sin args
@AllArgsConstructor                                 // 4. Constructor con todos los args
@JsonIgnoreProperties(ignoreUnknown = true)         // 5. Ignorar campos desconocidos
@JsonInclude(JsonInclude.Include.NON_NULL)          // 6. No serializar campos nulos
public class MiDto {
```

## ‚úÖ Ejemplos

### Ejemplo 1: Request DTO con Validaciones

```java
package com.bolivar.tienda.digital.transaccional.comunes.ms.dto.healthinsurance;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * DTO para la solicitud de cotizaci√≥n de prima de seguro de salud.
 * Contiene la fecha de referencia y la fecha de nacimiento del asegurado.
 *
 * @author Team Tienda Digital
 * @since 1.0.0
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class HealthInsurancePremiumRequestDto {

    /**
     * Fecha de referencia para el c√°lculo de la prima.
     * Formato: ISO 8601 (ejemplo: "2024-08-31T00:00:00.000")
     */
    @JsonProperty("referenceDate")
    private String referenceDate;

    /**
     * Fecha de nacimiento del asegurado principal.
     * Formato: ISO 8601 (ejemplo: "1964-09-17T00:00:00.000")
     */
    @JsonProperty("birthDate1")
    private String birthDate1;
}
```

### Ejemplo 2: Response DTO con M√©todos Helper

```java
package com.bolivar.tienda.digital.transaccional.comunes.ms.dto.healthinsurance;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * DTO para la respuesta de cotizaci√≥n de prima de seguro de salud.
 *
 * @author Team Tienda Digital
 * @since 1.0.0
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class HealthInsurancePremiumResponseDto {

    @JsonProperty("statusCode")
    private Integer statusCode;

    @JsonProperty("data")
    private HealthInsurancePremiumDataDto data;  // ‚Üê Clase separada

    @JsonProperty("error")
    private HealthInsurancePremiumErrorDataDto error;  // ‚Üê Clase separada

    /**
     * Verifica si la respuesta fue exitosa.
     */
    public boolean isSuccess() {
        return statusCode != null && statusCode == 200 && data != null;
    }

    /**
     * Obtiene el mensaje de error si existe.
     */
    public String getErrorMessage() {
        return error != null ? error.getMessage() : "Error desconocido";
    }
}
```

### Ejemplo 3: DTO para Objeto Anidado (Archivo Separado)

```java
package com.bolivar.tienda.digital.transaccional.comunes.ms.dto.healthinsurance;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * DTO que representa los datos de la prima calculada.
 *
 * @author Team Tienda Digital
 * @since 1.0.0
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class HealthInsurancePremiumDataDto {

    @JsonProperty("premium")
    private Integer premium;
}
```

**¬øPor qu√© archivo separado?**
- ‚úÖ Organizaci√≥n clara (3 archivos vs 1 grande)
- ‚úÖ Sin colisi√≥n de nombres
- ‚úÖ F√°cil de testear individualmente
- ‚úÖ Reutilizable si es necesario

### Ejemplo 4: Consistencia de Idiomas

**‚ùå INCORRECTO - Mezcla de idiomas en el mismo DTO**
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ProductFilterDto {

    /**
     * B√∫squeda por descripci√≥n (parcial).
     */
    @JsonProperty("searchTerm")       // ‚ùå Ingl√©s
    private String searchTerm;

    /**
     * Estado del producto (activo/inactivo).
     */
    @JsonProperty("estatus")          // ‚ùå Espa√±ol (mezcla con ingl√©s)
    private String estado;            // ‚ùå Espa√±ol (mezcla con ingl√©s)
}
```

**‚úÖ CORRECTO - Opci√≥n 1: Todo en Ingl√©s**
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ProductFilterDto {

    /**
     * B√∫squeda por descripci√≥n (parcial).
     */
    @JsonProperty("searchTerm")       // ‚úÖ Ingl√©s
    private String searchTerm;        // ‚úÖ Ingl√©s

    /**
     * Estado del producto (activo/inactivo).
     */
    @JsonProperty("status")           // ‚úÖ Ingl√©s (consistente)
    private String status;            // ‚úÖ Ingl√©s (consistente)
}
```

**‚úÖ CORRECTO - Opci√≥n 2: Todo en Espa√±ol**
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ProductFilterDto {

    /**
     * B√∫squeda por descripci√≥n (parcial).
     */
    @JsonProperty("terminoBusqueda")  // ‚úÖ Espa√±ol
    private String terminoBusqueda;   // ‚úÖ Espa√±ol

    /**
     * Estado del producto (activo/inactivo).
     */
    @JsonProperty("estatus")          // ‚úÖ Espa√±ol (consistente)
    private String estado;            // ‚úÖ Espa√±ol (consistente)
}
```

**Regla de consistencia:**
- ‚úÖ **Todos en ingl√©s**: `searchTerm`, `status`, `category`, `price`
- ‚úÖ **Todos en espa√±ol**: `terminoBusqueda`, `estatus`, `categoria`, `precio`
- ‚ùå **Mixto**: `searchTerm` + `estatus` (PROHIBIDO)

## üö´ Restricciones

1. **NO** omitir sufijo `Dto` en nombres
2. **NO** usar clases internas para objetos anidados (crear archivos separados)
3. **NO** crear DTOs en paquete ra√≠z `dto/` (usar `dto/{dominio}/` o `dto/{dominio}/{operacion}/`)
4. **NO** omitir anotaciones Lombok (`@Data`, `@Builder`, `@NoArgsConstructor`, `@AllArgsConstructor`)
5. **NO** omitir anotaciones Jackson (`@JsonProperty`, `@JsonIgnoreProperties(ignoreUnknown = true)`, `@JsonInclude(JsonInclude.Include.NON_NULL)`)
6. **NO** usar nombres gen√©ricos sin contexto (`Data.java`, `Error.java`)
7. **NO** incluir l√≥gica de negocio compleja (solo m√©todos helper simples)
8. **NO** usar `@Autowired` o inyectar servicios en DTOs
9. **NO** usar tipos primitivos para campos opcionales (usar wrappers: `Integer`, `Boolean`)
10. **NO** mezclar DTOs de diferentes dominios en el mismo subpaquete
11. **NO** mezclar DTOs de diferentes operaciones si hay m√∫ltiples endpoints (usar subcarpetas)
12. **NO** mezclar idiomas en el mismo DTO (todos en espa√±ol O todos en ingl√©s, NO mixto en `@JsonProperty` ni en nombres de variables)

## ‚úÖ Validaci√≥n Autom√°tica

Cursor debe detectar:

- ‚ùå Clases en `dto/` sin sufijo `Dto`
- ‚ùå DTOs en paquete ra√≠z `dto/` sin subpaquete
- ‚ùå Clases internas est√°ticas (`public static class`) para objetos anidados
- ‚ùå Falta de anotaciones Lombok (`@Data`, `@Builder`, `@NoArgsConstructor`, `@AllArgsConstructor`)
- ‚ùå Falta de anotaciones Jackson (`@JsonIgnoreProperties(ignoreUnknown = true)`, `@JsonInclude(JsonInclude.Include.NON_NULL)`)
- ‚ùå Campos sin `@JsonProperty` cuando mapean JSON
- ‚ùå Falta de JavaDoc en clases
- ‚ùå L√≥gica de negocio compleja m√°s all√° de m√©todos helper
- ‚ùå Uso de `@Autowired` en DTOs
- ‚ùå Nombres gen√©ricos sin contexto de dominio
- ‚ùå Mezcla de idiomas en el mismo DTO (espa√±ol + ingl√©s en `@JsonProperty` o nombres de variables)

## üéØ Objetivo + Regla de Oro

**Objetivo**: Crear DTOs organizados, mantenibles y reutilizables que representen claramente la estructura de datos de entrada/salida.

**REGLA DE ORO**: "Un DTO = Un archivo. Todos con sufijo `Dto`. Agrupar por dominio en `dto/{dominio}/`. Si m√∫ltiples operaciones, usar subcarpetas `dto/{dominio}/{operacion}/`. Lombok (`@Data`, `@Builder`, constructores) + Jackson (`@JsonProperty`, `@JsonIgnoreProperties`, `@JsonInclude`). Consistencia de idioma (espa√±ol O ingl√©s, NO mixto). Solo datos y m√©todos helper simples."

---

## üìã Aspectos Adicionales

### Anotaciones Jackson Obligatorias

#### `@JsonIgnoreProperties(ignoreUnknown = true)`
**Prop√≥sito**: Ignora campos desconocidos durante la deserializaci√≥n JSON ‚Üí DTO.

**Beneficios**:
- ‚úÖ **Tolerancia a cambios**: Si la API externa agrega campos nuevos, no lanza error
- ‚úÖ **Flexibilidad**: Solo mapea campos que necesitas, ignora el resto
- ‚úÖ **Retrocompatibilidad**: Aplicaciones antiguas no fallan con respuestas nuevas

**Ejemplo**:
```json
// Response de API externa
{
  "username": "john",
  "email": "john@example.com",
  "newField": "valor desconocido"  // ‚Üê Nuevo campo agregado por API
}
```

```java
// DTO con solo los campos necesarios - NO falla al deserializar
@JsonIgnoreProperties(ignoreUnknown = true)
public class UserDto {
    private String username;
    private String email;
    // "newField" es ignorado autom√°ticamente
}
```

#### `@JsonInclude(JsonInclude.Include.NON_NULL)`
**Prop√≥sito**: No serializa campos con valor `null` al convertir DTO ‚Üí JSON.

**Beneficios**:
- ‚úÖ **Responses limpios**: JSON m√°s peque√±o y legible
- ‚úÖ **Performance**: Menos datos en la red
- ‚úÖ **Claridad**: Solo muestra campos con valor

**Ejemplo**:
```java
@JsonInclude(JsonInclude.Include.NON_NULL)
public class UserResponseDto {
    private String username = "john";
    private String email = "john@example.com";
    private String phoneNumber = null;  // ‚Üê No se serializar√°
}
```

```json
// JSON resultante - campo null omitido
{
  "username": "john",
  "email": "john@example.com"
  // "phoneNumber" NO aparece en el JSON
}
```

### M√©todos Helper Permitidos
```java
// ‚úÖ PERMITIDO: Validaciones simples
public boolean isSuccess() {
    return statusCode != null && statusCode == 200;
}

// ‚úÖ PERMITIDO: Getters con l√≥gica simple
public String getErrorMessage() {
    return error != null ? error.getMessage() : "Error desconocido";
}

// ‚ùå PROHIBIDO: L√≥gica de negocio compleja
public void processData() {
    // llamadas a servicios, c√°lculos complejos, etc.
}
```

### Validaciones Bean Validation (Opcional)
```java
import jakarta.validation.constraints.NotBlank;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@JsonIgnoreProperties(ignoreUnknown = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class MiRequestDto {
    
    @NotBlank(message = "Campo obligatorio")
    @JsonProperty("campo")
    private String campo;
}
```

### Enums en DTOs
```java
// ‚úÖ CORRECTO: Enum dentro del DTO que lo usa
public class MiDto {
    private ParameterSource source;
    
    public enum ParameterSource {
        REQUEST, SERVICE
    }
}
```

---

> **Ver tambi√©n**: 
> - [servicios-01-creacion-servicios.mdc](./servicios-01-creacion-servicios.mdc) - Uso de DTOs en servicios
> - [servicios-02-feign-client.mdc](./servicios-02-feign-client.mdc) - DTOs en Feign Clients
> - [servicios-09-organizacion-capacidades.mdc](./servicios-09-organizacion-capacidades.mdc) - Organizaci√≥n por capacidades
